(()=>{"use strict";class e{constructor(e){this.letterW=e.letterW,this.iconW=e.iconW,this.letterB=e.letterB,this.iconB=e.iconB}asLetter(e=!0){return e?this.letterW:this.letterB}asIcon(e=!0){return e?this.iconW:this.iconB}}const t=[8,7,6,5,4,3,2,1],n=["a","b","c","d","e","f","g","h"],s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",o=!0,r={b:new e({letterW:"B",iconW:"♗",letterB:"b",iconB:"♝"}),r:new e({letterW:"R",iconW:"♖",letterB:"r",iconB:"♜"}),n:new e({letterW:"N",iconW:"♘",letterB:"n",iconB:"♞"}),k:new e({letterW:"K",iconW:"♔",letterB:"k",iconB:"♚"}),q:new e({letterW:"Q",iconW:"♕",letterB:"q",iconB:"♛"}),p:new e({letterW:"P",iconW:"♙",letterB:"p",iconB:"♟"})};function a(e,t){return`${e}${t}`}function c(e,t=!0){return e?{letter:e,color:t}:null}const i={getCellKey:a,createCellsMap:function(e,t){const n=[];return e.forEach((e=>{t.forEach((t=>{const s=a(t,e);n.push([s,null])}))})),new Map(n)},parseFenStrToObject:function(e){const t={},s=["r","n","b","k","q","p","R","N","B","K","Q","P"];return e.split(" ")[0].split("/").forEach(((e,o)=>{const r=8-o;let i=1;e.split("").forEach((e=>{if(s.includes(e)){const s=a(n[i-1],r),o=e==e.toUpperCase(),l=e.toLowerCase();t[s]=c(l,o),i+=1}else{const s=parseInt(e,10);for(let e=i;e<s+i;e++){const s=a(n[e-1],r);t[s]=null}i+=parseInt(e,10)}}))})),t},asSquare:c},l=function(e,t,s,o=!1){const r=n.indexOf(t),a=[];for(let n=s-1;n>=1;n--){a.push(i.getCellKey(t,n));const s=a[a.length-1];if(e.get(s)&&o)break}for(let n=s+1;n<=8;n++){a.push(i.getCellKey(t,n));const s=a[a.length-1];if(e.get(s)&&o)break}for(let t=r+1;t<n.length;t++){a.push(i.getCellKey(n[t],s));const r=a[a.length-1];if(e.get(r)&&o)break}for(let t=r-1;t>=0;t--){a.push(i.getCellKey(n[t],s));const r=a[a.length-1];if(e.get(r)&&o)break}return a},u=function(e,t){const s=n.indexOf(e),o=[];return[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]].forEach((e=>{const r=t+e[0],a=s+e[1];a>=0&&a<n.length&&r>0&&r<=8&&o.push(i.getCellKey(n[a],r))})),o},h=function(e,t,s){const o=n.indexOf(e),r=[],a=s?t+1:t-1;return[[1,a],[-1,a]].forEach((e=>{const t=o+e[0],s=e[1];t>=0&&t<n.length&&s>0&&s<=8&&r.push(i.getCellKey(n[t],s))})),r},d=function(e,t,s,o=!1){const r=n.indexOf(t),a=[];let c=1;for(let t=s-1;t>=0;t--){const s=r+c;if(s>=0&&s<n.length&&t>0&&t<=8){a.push(i.getCellKey(n[s],t)),c++;const r=a[a.length-1];if(e.get(r)&&o)break}}c=1;for(let t=s-1;t>=0;t--){const s=r-c;if(s>=0&&s<n.length&&t>0&&t<=8){a.push(i.getCellKey(n[s],t)),c++;const r=a[a.length-1];if(e.get(r)&&o)break}}c=1;for(let t=s+1;t<=8;t++){const s=r-c;if(s>=0&&s<n.length&&t>0&&t<=8){a.push(i.getCellKey(n[s],t)),c++;const r=a[a.length-1];if(e.get(r)&&o)break}}c=1;for(let t=s+1;t<=8;t++){const s=r+c;if(s>=0&&s<n.length&&t>0&&t<=8){a.push(i.getCellKey(n[s],t)),c++;const r=a[a.length-1];if(e.get(r)&&o)break}}return a},f=function(e,t){const s=n.indexOf(e),o=[];return[[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1]].forEach((e=>{const r=s+e[0],a=t+e[1];r>=0&&r<n.length&&a>0&&a<=8&&o.push(i.getCellKey(n[r],a))})),o},p=function(e,t,s=!0){const o=9-(t+1),r=n[e],a=i.getCellKey(r,o),c=12.5*e,l=12.5*t,u=`\n        <title>${a}</title>\n        <rect id="base-${a}" \n            data-square="${a}"\n            class="base" \n            width="12.5%" \n            height="12.5%"  />\n        <g id="markers-${a}" \n            data-square="${a}"\n            class="markers" \n            width="12.5%" \n            height="12.5%"  \n            fill="transparent"\n            />\n        <text id="piece-${a}" \n            data-square="${a}"\n            class="piece ${s?"asIcon":""}" \n            text-anchor="start" \n            x="${s?2:4}" \n            y="${s?-1:8}" \n            dy="${s?10:0}"\n         ></text>\n    `,h=document.createElementNS("http://www.w3.org/2000/svg","g");return h.setAttribute("class","square"),h.setAttribute("id",`${a}`),h.setAttribute("data-square",`${a}`),h.setAttribute("data-square-col",`${r}`),h.setAttribute("data-square-row",`${o}`),h.setAttribute("transform",`translate(${c},${l})`),h.innerHTML=u,h},g=function(e,t="",n=!0){const s=document.getElementById(`piece-${e}`),o=n?"white":"black";s.classList.add(o),s.textContent=t};class m{constructor(e){this.buffer={square:null},this.callBacks=e,this.panelControls()}squareControls(){const e=this;document.querySelectorAll(".square").forEach((t=>{t.addEventListener("click",(function(t){const n=(t.target||t.srcElement).getAttribute("data-square");e.setSelectedSquare(n)}),!1)}))}panelControls(){const e=this;document.querySelectorAll(".button-add-fig").forEach((t=>{t.addEventListener("click",(function(t){const n=(t.target||t.srcElement).getAttribute("data-letter"),s=n===n.toUpperCase();e.callBacks.onAdd(e.buffer.square,n.toLowerCase(),s),e.clearSelectedSquareFromBuffer()}),!1)})),document.getElementById("button-clear-square").addEventListener("click",(function(){e.callBacks.onClearSquare(e.buffer.square),e.clearSelectedSquareFromBuffer()}),!1),document.getElementById("button-paint-domains-w").addEventListener("click",(function(){e.callBacks.onDomainW()}),!1),document.getElementById("button-paint-domains-b").addEventListener("click",(function(){e.callBacks.onDomainB()}),!1),document.getElementById("button-paint-domains-wb").addEventListener("click",(function(){e.callBacks.onDomainW(),e.callBacks.onDomainB()}),!1),document.getElementById("button-clear").addEventListener("click",(function(){e.callBacks.onClear()}),!1),document.getElementById("button-init").addEventListener("click",(function(){e.callBacks.onInit()}),!1),document.getElementById("button-hide-domains-wb").addEventListener("click",(function(){e.callBacks.onDomainsHide()}),!1)}setSelectedSquare(e){if(this.buffer.square=e,e){const t=document.getElementById(`base-${e}`);t.classList.contains("with-selection")?t.classList.remove("with-selection"):t.classList.add("with-selection")}}clearSelectedSquareFromBuffer(){const e=this.buffer.square;if(e){const t=document.getElementById(`base-${e}`);t.classList.contains("with-selection")&&t.classList.remove("with-selection"),this.buffer.square=null}}}new class{constructor(e){this.config={asIcon:!("asIcon"in e)||e.asIcon,asLines:!("asLines"in e)||e.asLines,withLimitation:"withLimitation"in e&&e.withLimitation},this.figures=r,this.colors={white:o,black:!1},this.squaresMap=i.createCellsMap(t,n);const a="fen"in e?e.fen:s;this.fenToMap(a),this.render().then((()=>{this.chessControls=new m(this.chessActions),this.chessControls.squareControls()}))}get chessActions(){const e=this;return{onAdd:(t,n,s)=>{e.setFigureInSquare(t,n,s),e.drawPiecesFromMap()},onClearSquare:t=>{e.setFigureInSquare(t,null),e.drawPiecesFromMap()},onClear:()=>{e.squaresMap=i.createCellsMap(t,n),e.drawPiecesFromMap()},onInit:()=>{e.fenToMap(s),e.drawPiecesFromMap()},onDomainW:async()=>{const e=[];this.squaresMap.forEach(((t,n)=>{if(t&&t.color===o){const t=this.getOptionfromCell(n);e.push(...t)}})),e.forEach((e=>{document.getElementById(`base-${e}`).classList.add("with-domain-white")}))},onDomainB:async()=>{const t=[];e.squaresMap.forEach(((e,n)=>{if(e&&!1===e.color){const e=this.getOptionfromCell(n);t.push(...e)}})),t.forEach((e=>{document.getElementById(`base-${e}`).classList.add("with-domain-black")}))},onDomainsHide:async()=>{this.squaresMap.forEach(((e,t)=>{const n=document.getElementById(`base-${t}`).classList;n.remove("with-domain-white"),n.remove("with-domain-black")}))}}}async render(){await this.drawBoard()}fenToMap(e){if(!e||""===e)return;const t=i.parseFenStrToObject(e);this.squaresMap=new Map(Object.entries(t))}setFigureInSquare(e,t,n=!0){this.squaresMap.set(e,i.asSquare(t,n))}async drawBoard(){const e=document.getElementById("chess-svg");t.forEach(((t,s)=>{n.forEach(((t,n)=>{const o=p(n,s,this.config.asIcon);e.appendChild(o)}))})),this.drawPiecesFromMap()}drawPiecesFromMap(){this.squaresMap.forEach(((e,t)=>{if(e){let n="";const s=r[e.letter];n=!0===this.config.asIcon?s.asIcon(e.color):s.asLetter(e.color),g(t,n,e.color)}else g(t)}))}getOptionfromCell(e){const t=this.config.withLimitation,n=[];if(!e)return;const s=e.split(""),o=s[0],r=parseInt(s[1],10),{letter:a,color:c}=this.squaresMap.get(e);if("r"===a){const e=l(this.squaresMap,o,r,t);n.push(...e)}if("n"===a){const e=u(o,r);n.push(...e)}if("p"===a){const e=h(o,r,c);n.push(...e)}if("b"===a){const e=d(this.squaresMap,o,r,t);n.push(...e)}if("q"===a){const e=l(this.squaresMap,o,r,t),s=d(this.squaresMap,o,r,t);n.push(...e,...s)}if("k"===a){const e=f(o,r);n.push(...e)}return n}}({fen:"r3kb1r/ppp1n1pp/2nB1p2/3p4/3P2b1/2P2N2/PP1NQPPP/R3KB1R xx",asIcon:!0,asLines:!0,withLimitation:!0})})();
//# sourceMappingURL=main.289222cb412d401ec936.js.map